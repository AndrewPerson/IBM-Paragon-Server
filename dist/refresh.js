const e=require("process");const r=require("axios").default;class t{constructor(e){if("error"in e)throw new Error(e.error);if(!("access_token"in e))throw new Error("No access token present in token");if(this.access_token=e.access_token,!("refresh_token"in e))throw new Error("No refresh token present in token");if(this.refresh_token=e.refresh_token,"expiry"in e)this.expiry=new Date(e.expiry);else{var r=new Date;r.setHours(r.getHours()+1),this.expiry=r}if("termination"in e)this.termination=new Date(e.termination);else{var t=new Date;t.setHours(t.getHours()+2160),this.termination=t}}async refresh(e,t){var s=(await r.post("https://student.sbhs.net.au/api/token",new URLSearchParams({refresh_token:this.refresh_token,grant_type:"refresh_token",client_id:e,client_secret:t}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})).data;if("error"in s)throw new Error(s.error);if(!("access_token"in s))throw new Error("No access token present in token");if(this.access_token=s.access_token,"expiry"in s)this.expiry=new Date(s.expiry);else{var o=new Date;o.setHours(o.getHours()+1),this.expiry=o}}}var s;s={post:async function(e){if(!e)return{statusCode:400,body:"You must provide a code"};var r=new t(e);return await r.refresh(),{statusCode:200,body:r}}},global.main=async function(r){if(!(r.__ow_method in s))return{statusCode:405,body:"Unsupported HTTP method"};var t;try{t=await s[r.__ow_method](r)}catch(r){return console.log("LOGVERSION 3"),console.log("SUCCEEDED false"),console.log(`MEMORY ${e.memoryUsage().rss}`),{statusCode:500,body:`Error: ${r.message} Stack Trace: ${r.stack}`}}var o={statusCode:t.statusCode,headers:t.headers,body:t.body};return console.log("LOGVERSION 3"),console.log(`SUCCEEDED ${t.statusCode>=200&&t.statusCode<300}`),console.log(`MEMORY ${e.memoryUsage().rss}`),o};

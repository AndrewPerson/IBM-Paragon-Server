var l=Object.create;var i=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty;var d=r=>i(r,"__esModule",{value:!0});var u=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of w(e))!y.call(r,o)&&(t||o!=="default")&&i(r,o,{get:()=>e[o],enumerable:!(s=_(e,o))||s.enumerable});return r},g=(r,e)=>u(d(i(r!=null?l(k(r)):{},"default",!e&&r&&r.__esModule?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);var h=g(require("axios"));var c=require("process"),f="LOGVERSION 3";function p(r){global.main=async e=>{try{var t=await r(e)}catch(n){return console.log(n),console.log("SUCCEEDED false"),console.log(`MEMORY ${c.memoryUsage().rss}`),{statusCode:500,body:"Internal Server Error"}}var s=t.statusCode||200,o={statusCode:s,body:t.body};return console.log(f),console.log(`SUCCEEDED ${s>=200&&s<300}`),console.log(`MEMORY ${c.memoryUsage().rss}`),o}}var E=require("axios").default,a=class{constructor(e){if("error"in e)throw new Error(e.error);if("access_token"in e)this.access_token=e.access_token;else throw new Error("No access token present in token");if("refresh_token"in e)this.refresh_token=e.refresh_token;else throw new Error("No refresh token present in token");if("expiry"in e)this.expiry=new Date(e.expiry);else{var t=new Date;"expires_in"in e?t.setHours(t.getHours()+e.expires_in/3600):t.setHours(t.getHours()+1),this.expiry=t}if("termination"in e)this.termination=new Date(e.termination);else{var s=new Date;s.setHours(s.getHours()+90*24),this.termination=s}}async refresh(e,t){var s=await E.post("https://student.sbhs.net.au/api/token",new URLSearchParams({refresh_token:this.refresh_token,grant_type:"refresh_token",client_id:e,client_secret:t}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}),o=s.data;if("error"in o)throw new Error(o.error);if("access_token"in o)this.access_token=o.access_token;else throw new Error("No access token present in token");if("expiry"in o)this.expiry=new Date(o.expiry);else{var n=new Date;n.setHours(n.getHours()+1),this.expiry=n}}};p(async r=>{var s;if(!((s=r.__ow_body)==null?void 0:s.code))return{statusCode:400,body:"You must provide a code"};var e=await h.default.post("https://student.sbhs.net.au/api/token",new URLSearchParams({code:r.__ow_body,grant_type:"authorization_code",client_id:r.client_id,client_secret:r.client_secret,redirect_uri:"https://paragon.pages.dev/callback"}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}),t=new a(e.data);return{body:t}});

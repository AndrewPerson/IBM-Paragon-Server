var p=Object.create;var i=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var l=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var g=r=>i(r,"__esModule",{value:!0});var d=(r,e,s,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of l(e))!u.call(r,t)&&(s||t!=="default")&&i(r,t,{get:()=>e[t],enumerable:!(o=w(e,t))||o.enumerable});return r},y=(r,e)=>d(g(i(r!=null?p(k(r)):{},"default",!e&&r&&r.__esModule?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);var _=y(require("axios"));var c=require("process"),E="LOGVERSION 3";function h(r){global.main=async e=>{e.__ow_body!==void 0&&e.__ow_body!==null&&(e=Object.assign(JSON.parse(e.__ow_body),e));try{var s=await r(e)}catch(n){return console.log(n),console.log("SUCCEEDED false"),console.log(`MEMORY ${c.memoryUsage().rss}`),{statusCode:500,body:"Internal Server Error"}}var o=s.statusCode||200,t={statusCode:o,body:s.body};return console.log(E),console.log(`SUCCEEDED ${o>=200&&o<300}`),console.log(`MEMORY ${c.memoryUsage().rss}`),t}}var f=require("axios").default,a=class{constructor(e){if("error"in e)throw new Error(e.error);if("access_token"in e)this.access_token=e.access_token;else throw new Error("No access token present in token");if("refresh_token"in e)this.refresh_token=e.refresh_token;else throw new Error("No refresh token present in token");if("expiry"in e)this.expiry=new Date(e.expiry);else{var s=new Date;"expires_in"in e?s.setHours(s.getHours()+e.expires_in/3600):s.setHours(s.getHours()+1),this.expiry=s}if("termination"in e)this.termination=new Date(e.termination);else{var o=new Date;o.setHours(o.getHours()+90*24),this.termination=o}}async refresh(e,s){var o=await f.post("https://student.sbhs.net.au/api/token",new URLSearchParams({refresh_token:this.refresh_token,grant_type:"refresh_token",client_id:e,client_secret:s}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}),t=o.data;if("error"in t)throw new Error(t.error);if("access_token"in t)this.access_token=t.access_token;else throw new Error("No access token present in token");if("expiry"in t)this.expiry=new Date(t.expiry);else{var n=new Date;n.setHours(n.getHours()+1),this.expiry=n}}};h(async r=>{if(!r.code)return{statusCode:400,body:"You must provide a code"};var e=await _.default.post("https://student.sbhs.net.au/api/token",new URLSearchParams({code:r.code,grant_type:"authorization_code",client_id:r.CLIENT_ID,client_secret:r.CLIENT_SECRET,redirect_uri:"https://paragon.pages.dev/callback"}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}),s=new a(e.data);return{body:s}});

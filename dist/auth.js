var l=Object.create;var i=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var d=Object.getPrototypeOf,u=Object.prototype.hasOwnProperty;var k=r=>i(r,"__esModule",{value:!0});var f=(r,e,s,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of w(e))!u.call(r,o)&&(s||o!=="default")&&i(r,o,{get:()=>e[o],enumerable:!(t=p(e,o))||t.enumerable});return r},g=(r,e)=>f(k(i(r!=null?l(d(r)):{},"default",!e&&r&&r.__esModule?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);var _=g(require("axios"));var c=require("process"),y="LOGVERSION 3";function h(r){global.main=async e=>{try{var s=await r(e)}catch(n){return console.log(n),console.log("SUCCEEDED false"),console.log(`MEMORY ${c.memoryUsage().rss}`),{statusCode:500,body:"Internal Server Error"}}var t=s.statusCode||200,o={statusCode:t,headers:s.headers,body:s.body};return console.log(y),console.log(`SUCCEEDED ${t>=200&&t<300}`),console.log(`MEMORY ${c.memoryUsage().rss}`),o}}var E=require("axios").default,a=class{constructor(e){if("error"in e)throw new Error(e.error);if("access_token"in e)this.access_token=e.access_token;else throw new Error("No access token present in token");if("refresh_token"in e)this.refresh_token=e.refresh_token;else throw new Error("No refresh token present in token");if("expiry"in e)this.expiry=new Date(e.expiry);else{var s=new Date;"expires_in"in e?s.setHours(s.getHours()+e.expires_in/3600):s.setHours(s.getHours()+1),this.expiry=s}if("termination"in e)this.termination=new Date(e.termination);else{var t=new Date;t.setHours(t.getHours()+90*24),this.termination=t}}async refresh(e,s){var t=await E.post("https://student.sbhs.net.au/api/token",new URLSearchParams({refresh_token:this.refresh_token,grant_type:"refresh_token",client_id:e,client_secret:s}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}),o=t.data;if("error"in o)throw new Error(o.error);if("access_token"in o)this.access_token=o.access_token;else throw new Error("No access token present in token");if("expiry"in o)this.expiry=new Date(o.expiry);else{var n=new Date;n.setHours(n.getHours()+1),this.expiry=n}}};h(async r=>{if(!r.__ow_body)return{statusCode:400,body:"You must provide a code"};if(r.__ow_body.length==0)return{statusCode:400,body:"You must provide a code"};var e=await _.default.post("https://student.sbhs.net.au/api/token",new URLSearchParams({code:r.__ow_body,grant_type:"authorization_code",client_id:r.client_id,client_secret:r.client_secret,redirect_uri:"https://beta-paragon.web.app/callback"}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}),s=new a(e.data);return{body:s}});

var w=Object.create;var i=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,d=Object.prototype.hasOwnProperty;var y=r=>i(r,"__esModule",{value:!0});var E=(r,e,s,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of g(e))!d.call(r,o)&&(s||o!=="default")&&i(r,o,{get:()=>e[o],enumerable:!(t=k(e,o))||t.enumerable});return r},c=(r,e)=>E(y(i(r!=null?w(u(r)):{},"default",!e&&r&&r.__esModule?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);var l=c(require("axios"));var h=require("process"),f="LOGVERSION 3";function _(r){global.main=async e=>{e.__ow_body!==void 0&&e.__ow_body!==null&&(e=Object.assign(JSON.parse(e.__ow_body),e));try{var s=await r(e)}catch(n){return console.log(n),console.log("SUCCEEDED false"),console.log(`MEMORY ${h.memoryUsage().rss}`),{statusCode:500,body:"Internal Server Error"}}var t=s.statusCode||200,o={statusCode:t,body:s.body};return console.log(f),console.log(`SUCCEEDED ${t>=200&&t<300}`),console.log(`MEMORY ${h.memoryUsage().rss}`),o}}var p=c(require("axios")),a=class{constructor(e){if("error"in e)throw new Error(e.error);if("access_token"in e)this.access_token=e.access_token;else throw new Error("No access token present in token");if("refresh_token"in e)this.refresh_token=e.refresh_token;else throw new Error("No refresh token present in token");if("expiry"in e)this.expiry=new Date(e.expiry);else{var s=new Date;"expires_in"in e?s.setHours(s.getHours()+e.expires_in/3600):s.setHours(s.getHours()+1),this.expiry=s}if("termination"in e)this.termination=new Date(e.termination);else{var t=new Date;t.setHours(t.getHours()+90*24),this.termination=t}}async refresh(e,s){var t=await p.default.post("https://student.sbhs.net.au/api/token",new URLSearchParams({refresh_token:this.refresh_token,grant_type:"refresh_token",client_id:e,client_secret:s}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}),o=t.data;if("error"in o)throw new Error(o.error);if("access_token"in o)this.access_token=o.access_token;else throw new Error("No access token present in token");if("expiry"in o)this.expiry=new Date(o.expiry);else{var n=new Date;n.setHours(n.getHours()+1),this.expiry=n}}};_(async r=>{if(!r.code)return{statusCode:400,body:"You must provide a code"};var e=await l.default.post("https://student.sbhs.net.au/api/token",new URLSearchParams({code:r.code,grant_type:"authorization_code",client_id:r.CLIENT_ID,client_secret:r.CLIENT_SECRET,redirect_uri:"https://paragon.pages.dev/callback"}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}),s=new a(e.data);return{body:s}});
